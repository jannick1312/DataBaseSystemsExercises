%% ================================================================
%% # DBIS Databases Hand-in Template
%% 
%% Template for students to hand-in their databases exercise solutions.
%% 
%% [Databases and Information Systems Group](https://dbis.dmi.unibas.ch/)
%%
%% ## Usage
%% 
%% Fill in the required fields and write your submission
%%
%% ## Issues
%%
%% See dbisdbhandin.sty for further information.
%% ================================================================
\documentclass{article}
\usepackage{dbisdbhandin}
\usepackage[english]{babel}
%% ================================================================
%%
%% General Information
%%
%% ================================================================
%%
%% Add your information here
\course       {Databases}
\semester     {Autumn 2025}
\exerciseno   {1}
\studenta     {Aiysha Frutiger}
\studentb     {Jannick Seper}
\studentc     {Luis Tritschler}
%% Comment if you do the exercises alone


%% ================================================================
%%
%% Common Packages
%%
%% ================================================================
%%
%% Useful common packages for this course

%% Include pdfs into latex
\usepackage{pdfpages}
%% \includepdf[pages=1,pagecommand={\pagestyle{fancy}}]{filename}

%% Drawing everything, with lots of libraries
\usepackage{tikz}
%% A library providing ER prefabs
\usetikzlibrary{er}
\usetikzlibrary{positioning,arrows.meta}
%% ================================================================
%%
%% Custom Packages
%%
%% ================================================================
%%
%% Add custom packages below:
%%

% \usepackage{mypackage}

%% ================================================================
%%
%% Custom Commands
%%
%% ================================================================
%%
%% DRY: Use commands when you use something often or you'd like
%% to define it only once
%%

\newcommand*{\TikZ}{Ti\textit{k}Z}


\begin{document}
%% Required for the title
\printfront
%% ================================================================
%%
%% Description
%%
%% ================================================================

%% ================================================================
%%
%% Your Solution
%%
%% ================================================================
%%
%% Add your solution below
\task{}

\begin{enumerate}[(a)]
\item
Which instructor (LastName, FirstName) created the lesson with the LessonID 42?
\begin{equation}
\pi\left[LastName,FirstName\right](\sigma\left[LessonID='42'\right](Lesson)\Join instructor)
\end{equation}

\item
In which semesters and for which courses was the sub-lesson with ID 21 used?
\begin{align}
    \begin{split}
\pi\left[Semester, Title, No, CourseID\right]\\
(((\pi\left[MainLessonID\right](\sigma\left[SubLessonID = '21'\right](is\_part\_of)))\Join \\
\left[MainLessonID = LessonID\right](includes))\Join(course))
    \end{split}
\end{align}

\item
What lessons (LessonID, Description) consist of sub-lessons?
\begin{align}
    \begin{split}
\pi\left[LessonID,Description\right](is\_part\_of\Join \\
\left[MainLessonID=LessonID\right](Lesson))
    \end{split}
\end{align}

\item
Which courses were taught exclusively by Jon Snow?
\begin{align}
    \begin{split}
T \;=&\; ((\text{includes} \Join \\[-1pt]
&\left[\text{includes.LessonID}=\text{Lesson.LessonID}\right] \text{Lesson}) \Join \\[-1pt]
&\left[\text{Lesson.InstructorID}=\text{Instructor.InstructorID}\right] \text{Instructor})\\[4pt]
\text{Bad} \;=&\; \pi\left[\text{CourseID}\right]\big(\sigma\left[\neg(\text{LastName}='Snow' \land \text{FirstName}='Jon')\right](T)\big)\\[4pt]
\text{Good} \;=&\; \pi\left[\text{CourseID}\right](\text{includes})\;-\;\text{Bad}\\[4pt]
&\pi\left[\text{Semester},\ \text{Title},\ \text{No},\ \text{CourseID}\right]
\big(\text{Course} \Join \\[-1pt]
&\left[\text{Course.CourseID}=\text{Good.CourseID}\right] \text{Good}\big)
    \end{split}
\end{align}



\item 
What lessons (including the sub-lessons) are contained inside course 1 of the semester Spring 2024 and titled Database Systems?
\begin{align}
    \begin{split}
\pi\left[\text{Lesson.LessonID},\ \text{Description}\right]
\Big(\ \text{Lesson}\ \Join
\left[\text{Lesson.LessonID}=\text{A.LessonID}\right]\ A\ \Big)
    \end{split}
\end{align}


\item How long (in minutes) is the lesson with the ID (LessonID) 21?
\begin{align}
    (l.Duration \mid l \in Lesson \wedge l.LessonID = 21)
\end{align}

\item Which lessons of the semester Autumn 2025 have a duration of less than 30 minutes?
\begin{align}
    \begin{split}
   (l \mid l \in Lesson \wedge l.Duration < 30 \wedge \exists c \in Course (c.Semester = Autumn 2025)\wedge \\ 
   \exists\in Includes(i.CourseID=c.CourseID\wedge i.LessonID = l.LessonID))
    \end{split}
\end{align}

\item For which semesters exist courses with main lessons where Jon Snow instructed at least one lesson?
\begin{align}
    \begin{split}
   (c.Semester \mid c \in Course\wedge\exists i \in \\
   Includes(\exists l \in Lesson(l.LessonID = i.LessonID \wedge \\
   \exists j \in Instructor (l.InstructorID = j.InstructorID \wedge \\ 
   j.LastName=Snow \wedge j.FirstName = John))))
    \end{split}
\end{align}

\item What lessons consist of sub-lessons that have been instructed by at least two different instructors?
\begin{align}
    \begin{split}
   (l \mid l \in Lesson \wedge \exists i_1 \in is\_part\_of (i_1.MainLessonID=l.LessonID\wedge \\
   \exists l_1 \in Lesson(l_1.LessonID=i_1.SubLessonID))\\
   \exists i_2 \in is\_part\_of (i_2.MainLessonID=i_1.MainLessonID\wedge \\
   \exists l_2 \in Lesson(l_2.LessonID=i_2.SubLessonID\wedge l_1.InstructorID \neq l_2.InstructorID)))
    \end{split}
\end{align}

\item Which courses contain only main lessons with a difficulty of at least 3?
\begin{equation}
    \begin{split}
    (c \mid c \in Course \wedge \forall i\in includes(c.CourseID = i.CourseID \wedge \\
    \forall l \in Lesson(l.LessonID=i.LessonID\wedge l.Difficulty \geq 3)))
    \end{split}
\end{equation}


\end{enumerate}

\task{}
\begin{enumerate}[(a)]
\item
Person on Name:
\begin{equation}
\sigma\left[Name='Christopher Nolan'\right](Person)
\end{equation}

Activity on SceneAuthor:
\begin{equation}
\sigma\left[Activity='director'\right](SceneAuthor)
\end{equation}

Add join on both:
\begin{multline}
\pi\left[MovieID,SceneID\right](\sigma\left[Name='Christopher Nolan' \land Activity='director'\right]\\
 (Person \Join SceneAuthor))
\end{multline}

\item
Movie on Title:
\begin{equation}
\sigma[MovieTitle='Inception'](Movie)
\end{equation}

Hans Zimmer as composer (within that movie):
\begin{multline}
\pi\left[MovieID,SceneID\right]\\
 (\sigma\left[MovieTitle='Inception' \land Name='Hans Zimmer' \land Activity='composer'\right]\\
 (Movie \Join SceneAuthor \Join Person))
\end{multline}

Christopher Nolan as screenwriter (within that movie):
\begin{multline}
\pi\left[MovieID,SceneID\right]\\
 (\sigma\left[MovieTitle='Inception' \land Name='Christopher Nolan' \land Activity='screenwriter'\right]\\
 (Movie \Join SceneAuthor \Join Person))
\end{multline}

Intersect on scene key then output SceneID:
\begin{multline}
\pi\left[SceneID\right]\\
((\pi\left[MovieID,SceneID\right]\\
 (\sigma\left[MovieTitle='Inception' \land Name='Hans Zimmer' \land Activity='composer'\right]\\
 (Movie \Join SceneAuthor \Join Person))) \cap \\
 (\pi\left[MovieID,SceneID\right]\\
 (\sigma\left[MovieTitle='Inception' \land Name='Christopher Nolan' \land Activity='screenwriter'\right]\\
 (Movie \Join SceneAuthor \Join Person))))
\end{multline}

\item
Person on Name:
\begin{equation}
\sigma\left[Name='Quentin Tarantino'\right](Person)
\end{equation}

Actor role on ScenePerformer:
\begin{equation}
\sigma\left[Role='actor'\right](ScenePerformer)
\end{equation}

Director activity on SceneAuthor:
\begin{equation}
\sigma\left[Activity='director'\right](SceneAuthor)
\end{equation}

Combine and output scene Titles:
\begin{multline}
\pi\left[Title\right](\sigma\left[Name='Quentin Tarantino' \land Role='actor' \land Activity='director'\right]\\
 (Scene \Join ScenePerformer \Join SceneAuthor \Join Person))
\end{multline}

\item
Actor on ScenePerformer:
\begin{equation}
\sigma\left[Name='Robert Downey Jr.' \land Role='actor'\right](ScenePerformer \Join Person)
\end{equation}

Author on SceneAuthor:
\begin{equation}
\sigma\left[Name='Robert Downey Jr.'\right](SceneAuthor \Join Person)
\end{equation}

Union on MovieID, then output MovieTitle:
\begin{multline}
\pi\left[MovieTitle\right]\\
 ((\pi\left[MovieID\right](\sigma\left[Name='Robert Downey Jr.' \land Role='actor'\right](ScenePerformer \Join Person))\\
 \cup \pi\left[MovieID\right](\sigma\left[Name='Robert Downey Jr.'\right](SceneAuthor \Join Person))) \Join Movie)
\end{multline}

\item
Actor on ScenePerformer:
\begin{equation}
\sigma\left[Name='Scarlett Johansson' \land Role='actor'\right](ScenePerformer \Join Person)
\end{equation}

Stunt double on ScenePerformer:
\begin{equation}
\sigma\left[Name='Scarlett Johansson' \land Role='stunt double'\right](ScenePerformer \Join Person)
\end{equation}

Intersect on scene key, then output Titles:
\begin{multline}
\pi\left[Title\right]\\
 ((\pi\left[MovieID,SceneID\right](\sigma\left[Name='Scarlett Johansson' \land Role='actor'\right]\\
 (ScenePerformer \Join Person)) \cap \pi\left[MovieID,SceneID\right]\\
 (\sigma\left[Name='Scarlett Johansson' \land Role='stunt double'\right]\\
 (ScenePerformer \Join Person))) \Join Scene)
\end{multline}

\item
Person on Name (subset of Person):
\begin{equation}
F_{1.1} = \{p | p \in Person \land p.Name='Christopher Nolan' \}
\end{equation}

Activity on SceneAuthor (subset of SceneAuthor):
\begin{equation}
F_{1.2} = \{sa | sa \in SceneAuthor \land sa.Activity='director' \}
\end{equation}

Join by PID, output (MovieID,SceneID) without Person:
\begin{multline}
\{\langle sa.MovieID, sa.SceneID \rangle | sa \in F_{1.2} \land \exists p(p \in F_{1.1} \land p.PID = sa.PID)\}
\end{multline}

\item
Movie on Title:
\begin{equation}
G_{2.1} = \{m | m \in Movie \land m.MovieTitle='Inception'\}
\end{equation}

Hans Zimmer as composer (within that movie):
\begin{multline}
G_{2.2} = \{sa | sa \in SceneAuthor \land sa.Activity='composer' \land \\
\exists p(p \in Person \land p.PID=sa.PID \land p.Name='Hans Zimmer') \land \\
\exists m(m \in G_{2.1} \land m.MovieID=sa.MovieID)\}
\end{multline}

Christopher Nolan as screenwriter (within that movie):
\begin{multline}
G_{2.3} = \{sa | sa \in SceneAuthor \land sa.Activity='screenwriter' \land \\
\exists p(p \in Person \land p.PID=sa.PID \land p.Name='Christopher Nolan') \land \\
\exists m(m \in G_{2.1} \land m.MovieID=sa.MovieID)\}
\end{multline}

Intersect on full scene key, then output SceneID:
\begin{equation}
\{\langle x.SceneID \rangle | x \in G_{2.2} \land \exists y(y \in G_{2.3} \land y.MovieID=x.MovieID \land y.SceneID=x.SceneID) \}
\end{equation}

\item
Person on Name (subset of Person):
\begin{equation}
H_{3.1} = \{ p | p \in Person \land p.Name='Quentin Tarantino' \}
\end{equation}

Actor role on ScenePerformer:
\begin{equation}
H_{3.2} = \{ sp | sp \in ScenePerformer \land sp.Role='actor' \}
\end{equation}

Director activity on SceneAuthor:
\begin{equation}
H_{3.3} = \{ sa | sa \in SceneAuthor \land sa.Activity='director' \}
\end{equation}

Join on person and scene, then output Title:
\begin{multline}
\{ \langle s.Title \rangle | s \in Scene \land \exists p\exists sp\exists sa(p \in H_{3.1} \land sp \in H_{3.2} \land sa \in H_{3.3} \land {}\\
 sp.PID=p.PID \land sa.PID=p.PID \land \\
 sp.MovieID=sa.MovieID \land sp.SceneID=sa.SceneID \land \\
 s.MovieID=sp.MovieID \land s.SceneID=sp.SceneID ) \}
\end{multline}

\item
Person on Name (subset of Person):
\begin{equation}
I_{4.1} = \{ p | p \in Person \land p.Name='Robert Downey Jr.' \}
\end{equation}

Actor role on ScenePerformer:
\begin{equation}
I_{4.2} = \{ sp | sp \in ScenePerformer \land sp.Role='actor' \}
\end{equation}

Any author activity on SceneAuthor:
\begin{equation}
I_{4.3} = \{ sa | sa \in SceneAuthor \}
\end{equation}

Actor or author in the same movie, then output MovieTitle:
\begin{multline}
\{ \langle m.MovieTitle \rangle | m \in Movie \land (\exists p\exists sp(p \in I_{4.1} \land sp \in I_{4.2} \land \\
 sp.PID=p.PID \land sp.MovieID=m.MovieID) \lor {}\\
\exists q\exists sa(q \in I_{4.1} \land sa \in I_{4.3} \land sa.PID=q.PID \land sa.MovieID=m.MovieID)
) \}
\end{multline}

\item
Person on Name (subset of Person):
\begin{equation}
J_{5.1} = \{ p | p \in Person \land p.Name='Scarlett Johansson' \}
\end{equation}

Actor role on ScenePerformer:
\begin{equation}
J_{5.2} = \{ spA | spA \in ScenePerformer \land spA.Role='actor' \}
\end{equation}

Stunt double role on ScenePerformer:
\begin{equation}
J_{5.3} = \{ spS | spS \in ScenePerformer \land spS.Role='stunt double' \}
\end{equation}

Same person, same scene, then output Title:
\begin{multline}
\{ \langle s.Title \rangle | s \in Scene \land \exists p\exists spA\exists spS(p \in J_{5.1} \land spA \in J_{5.2} \land spS \in J_{5.3} \land {}\\
 spA.PID=p.PID \land spS.PID=p.PID \land \\
 spA.MovieID=spS.MovieID \land spA.SceneID=spS.SceneID \land\\
 s.MovieID=spA.MovieID \land s.SceneID=spA.SceneID ) \}
\end{multline}


\end{enumerate}

\end{document}
